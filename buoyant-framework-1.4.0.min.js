/*
 BuoyantJS v1.4.0
 (c) 2013-2015 by Depth Development. http://depthdev.com
 License: Apache 2.0
*/
"use strict";var $$Buoyant=function(e){this.prefix="by",this.offlineSupport=!1,this.offline=!1,e&&(this.prefix=e.hasOwnProperty("prefix")?e.prefix:"by",this.offlineSupport=e.hasOwnProperty("offlineSupport")?e.offlineSupport:!1,this.offline=e.hasOwnProperty("offline")?e.offline:!1),function(){var e=document.createElement("style");e.textContent="["+this.prefix+"-cloak], ["+this.prefix+"-ready] { display: none !important; }",document.querySelector("head").appendChild(e)}.bind(this),this.viewSelector=document.querySelector("["+this.prefix+"-view]")};$$Buoyant.prototype.parseNodeList=function(e){for(var t=[],r=document.querySelectorAll(e),o=0,n=r.length;n>o;o++)t[o]=r[o];return t},$$Buoyant.prototype.parseListener=function(e){return e.replace(/(\s|\(|\))/g,"")},$$Buoyant.prototype.reset=function(){if(this.controllerUnbind(this.controllerName),this.resources[this.controllerName].hasOwnProperty("view"))if(this.resources[this.controllerName].hasOwnProperty("styles")){this.viewSelector.innerHTML="<style>"+this.resources[this.controllerName].styles+"</style>";var e=document.createDocumentFragment(),t=document.createElement("div");t.innerHTML=this.resources[this.controllerName].view,e.appendChild(t.childNodes[0]),this.viewSelector.appendChild(e)}else this.viewSelector.innerHTML=this.resources[this.controllerName].view;this.controllerBind(this.controllerName)},$$Buoyant.prototype.http=function(e){var t=new XMLHttpRequest;if(!t)return e.hasOwnProperty("error")&&e.error("Could not establish HTTP request."),!1;t.onreadystatechange=function(){if(4===t.readyState){var r=t.responseText;"json"===e.dataType&&(r=JSON.parse(r)),200===t.status?e.hasOwnProperty("success")&&e.success(r):e.hasOwnProperty("error")&&e.error(r),e.hasOwnProperty("finally")&&e["finally"](r)}};var r=function(){return e.hasOwnProperty("method")?e.method.toUpperCase():e.hasOwnProperty("type")?e.type.toUpperCase():"POST"}(),o=function(){return e.hasOwnProperty("action")?e.action:e.url}();if(t.open(r,o),e.hasOwnProperty("dataType"))switch(e.dataType=e.dataType.toLowerCase(),e.dataType){case"html":t.setRequestHeader("Content-Type","text/html;charset=UTF-8");break;case"json":t.setRequestHeader("Content-Type","application/json;charset=UTF-8"),e.hasOwnProperty("data")&&(e.data=JSON.stringify(e.data));break;case"script":t.setRequestHeader("Content-Type","application/javascript;charset=UTF-8");break;case"xml":t.setRequestHeader("Content-Type","text/xml;charset=UTF-8");break;default:t.setRequestHeader("Content-Type","text/plain;charset=UTF-8")}else t.setRequestHeader("Content-Type","text/plain;charset=UTF-8");e.hasOwnProperty("data")?t.send(e.data):t.send()},$$Buoyant.prototype.bindFromDev=function(e){for(var t=this.parseNodeList("["+this.prefix+'-controller="'+e+'"] ['+this.prefix+"-bind]"),r=0,o=t.length;o>r;r++)/(INPUT|TEXTAREA|PROGRESS)/i.test(t[r].nodeName)?t[r].value=this.$$[e][t[r].getAttribute(this.prefix+"-bind")]:t[r].textContent=this.$$[e][t[r].getAttribute(this.prefix+"-bind")]},$$Buoyant.prototype.bindFromUser=function(e,t){/(INPUT|TEXTAREA|PROGRESS)/i.test(t.nodeName)?this.$$[e][t.getAttribute(this.prefix+"-bind")]=t.value:this.$$[e][t.getAttribute(this.prefix+"-bind")]=t.textContent},$$Buoyant.prototype.resources={},$$Buoyant.prototype.route={},$$Buoyant.prototype.router=function(e,t){var r=this;if(this.controllerName&&this.$$.hasOwnProperty(this.controllerName)&&this.controllerUnbind(this.controllerName),t||(this.controllerName=e),this.resources.hasOwnProperty(e)){if(delete this.$$[e],this.$$[e]={},!t)if(this.resources[e].hasOwnProperty("styles")){this.viewSelector.innerHTML="<style>"+this.resources[e].styles+"</style>";var o=document.createDocumentFragment(),n=document.createElement("div");n.innerHTML=this.resources[e].view,o.appendChild(n.childNodes[0]),this.viewSelector.appendChild(o)}else this.viewSelector.innerHTML=this.resources[e].view;setTimeout(function(){r.controllerBind(e,r.resources[e].model)},10)}},$$Buoyant.prototype.routeInit=function(){var e=this,t=function n(t){e.route.hasOwnProperty(t)?e.router(e.route[t]):setTimeout(function(){n(t)},100)},r=location.hash;if(!/#\!\//.test(window.location.href.toString())&&r);else if(/#\!\//.test(r)){var o=r.replace(/#\!/,"").replace(/\/$/,"");history.replaceState("","",o),t(o)}else t(location.pathname)},$$Buoyant.prototype.controllerName=void 0,$$Buoyant.prototype.controller=function(e,t){this.resources.hasOwnProperty(e)?this.resources[e].model=t:(this.resources[e]={},this.resources[e].model=t,this.router(e,!0))},$$Buoyant.prototype.controllerUnbind=function(e){},$$Buoyant.prototype.controllerBind=function(e,t){try{var r=this,o=document.querySelector("["+this.prefix+'-controller="'+e+'"]');o.addEventListener("click",function(){r.bindFromUser(e,event.target)}),o.addEventListener("keyup",function(){r.bindFromUser(e,event.target)}),o.addEventListener("change",function(){r.bindFromUser(e,event.target)}),t&&t(this.$$[e],this.http.bind(this));for(var n=this.parseNodeList("["+this.prefix+'-controller="'+e+'"] ['+this.prefix+"-for]"),s=0,a=n.length;a>s;s++){var i=n[s].outerHTML,l=new RegExp(".*"+this.prefix+'\\-for\\="\\s*(\\w+)\\s+in\\s+(\\w+)[.\\s\\S]+'),c=i.replace(l,"$1BuoyantJS$2");l=new RegExp("\\s+"+this.prefix+'\\-cloak\\=?("{2})?',"g"),i=i.replace(l,"");for(var p=c.replace(/(\w+)BuoyantJS.+/,"$1"),h=c.replace(/\w+BuoyantJS(\w+)/,"$1"),u=this.$$[e][h].length,y=new RegExp("{{\\s*"+p+"\\.\\w+\\s*}}","g"),f=i.match(y),d=[],$=0,v=f.length;v>$;$++)d[$]=f[$].replace(/\{\{\s*\w+\.(\w+)\s*\}\}/,"$1");for(var m="",w="",$=0,v=u;v>$;$++){w=i;for(var g=0,T=f.length;T>g;g++){var x=new RegExp(f[g]);w=w.replace(x,this.$$[e][h][$][d[g]])}m+=w}var S=n[s].parentNode,O=document.createDocumentFragment(),P=document.createElement("div");P.innerHTML=m;for(var N=P.childNodes,b=[],$=0,v=N.length;v>$;$++)b[$]=P.childNodes[$];for(var $=0,v=b.length;v>$;$++)O.appendChild(b[$]);S.insertBefore(O,n[s]),S.removeChild(n[s])}this.bindFromDev(e);for(var B=this.parseNodeList("["+this.prefix+'-controller="'+e+'"] ['+this.prefix+"-click]"),s=0,a=B.length;a>s;s++)B[s].addEventListener("click",function(){r.$$[e][r.parseListener(this.getAttribute(r.prefix+"-click"))].call(this)},!1);for(var L=this.parseNodeList("["+this.prefix+'-controller="'+e+'"] ['+this.prefix+"-keyup]"),s=0,a=L.length;a>s;s++)L[s].addEventListener("keyup",function(){r.$$[e][r.parseListener(this.getAttribute(r.prefix+"-keyup"))].call(this)},!1);for(var C=this.parseNodeList("["+this.prefix+'-controller="'+e+'"] ['+this.prefix+"-change]"),s=0,a=C.length;a>s;s++)C[s].addEventListener("change",function(){r.$$[e][r.parseListener(this.getAttribute(r.prefix+"-change"))].call(this)},!1)}catch(E){console.log('BuoyantJS resource(s) are missing; or, names do not match across all associations for the "'+e+'" controller.')}},$$Buoyant.prototype.$$={},$$Buoyant.prototype.$$reset=function(){this.reset()},$$Buoyant.prototype.$$http=function(e){var t=this,r=new XMLHttpRequest;if(!r)return e.hasOwnProperty("error")&&e.error("Could not establish HTTP request."),!1;r.onreadystatechange=function(){if(4===r.readyState){var o=r.responseText;"json"===e.dataType&&(o=JSON.parse(o)),200===r.status?e.hasOwnProperty("success")&&e.success(o):e.hasOwnProperty("error")&&e.error(o),e.hasOwnProperty("finally")&&e["finally"](o),t.reset()}};var o=function(){return e.hasOwnProperty("method")?e.method.toUpperCase():e.hasOwnProperty("type")?e.type.toUpperCase():"POST"}(),n=function(){return e.hasOwnProperty("action")?e.action:e.url}();if(r.open(o,n),e.hasOwnProperty("dataType"))switch(e.dataType=e.dataType.toLowerCase(),e.dataType){case"html":r.setRequestHeader("Content-Type","text/html;charset=UTF-8");break;case"json":r.setRequestHeader("Content-Type","application/json;charset=UTF-8"),e.hasOwnProperty("data")&&(e.data=JSON.stringify(e.data));break;case"script":r.setRequestHeader("Content-Type","application/javascript;charset=UTF-8");break;case"xml":r.setRequestHeader("Content-Type","text/xml;charset=UTF-8");break;default:r.setRequestHeader("Content-Type","text/plain;charset=UTF-8")}else r.setRequestHeader("Content-Type","text/plain;charset=UTF-8");e.hasOwnProperty("data")?r.send(e.data):r.send()},$$Buoyant.prototype.$$routes=function(e){var t=this;if(this.offline&&localStorage.hasOwnProperty("BuoyantJS_resources"))this.route=JSON.parse(localStorage.getItem("BuoyantJS_route")),this.resources=JSON.parse(localStorage.getItem("BuoyantJS_resources"));else for(var r=0,o=e.length;o>r;r++)this.route[e[r].url]=e[r].controller,this.resources[e[r].controller]={};/Edge|Trident|MSIE/.test(navigator.userAgent)?addEventListener("hashchange",function(e){e.preventDefault(),t.routeInit()}):addEventListener("popstate",function(e){e.preventDefault(),t.routeInit()});var n=window.location.href.toString(),s=(/\/#\!/.test(n)?n.replace(/https?:\/\/.+\/#\!/,"").replace(/\/$/,""):"/",function(){t.routeInit();for(var e=t.parseNodeList("["+t.prefix+"-ready]"),r=0,o=e.length;o>r;r++)e[r].removeAttribute(t.prefix+"-ready");t.$$ready()});if(t.offline)s();else{for(var a=function(){i===l+p&&(t.offlineSupport&&(localStorage.setItem("BuoyantJS_route",JSON.stringify(t.route)),localStorage.setItem("BuoyantJS_resources",JSON.stringify(t.resources))),s())},i=function(){for(var t=e.length,r=0,o=e.length;o>r;r++)e[r].hasOwnProperty("styles")&&(Array.isArray(e[r].styles)?t+=e[r].styles.length:t++);return t}(),l=0,c=function(r){t.http({action:e[r].view,method:"GET",dataType:"HTML",success:function(o){t.resources[e[r].controller].view=o},error:function(t){console.log("No view found for controller: "+e[r].controller+".")},"finally":function(e){l++,a()}})},r=0;r<e.length;r++)c(r);for(var p=0,h=function(r,o){t.http({action:o||0===o?e[r].styles[o]:e[r].styles,method:"GET",dataType:"text",success:function(o){var n=t.resources[e[r].controller];n.styles?n.styles+=o:n.styles=""+o},error:function(t){console.log("No style(s) found for controller: "+e[r].controller+".")},"finally":function(e){p++,a()}})},r=0;r<e.length;r++)if(e[r].hasOwnProperty("styles"))if(Array.isArray(e[r].styles))for(var u=0,y=e[r].styles.length;y>u;u++)h(r,u);else h(r)}},$$Buoyant.prototype.$$ready=function(){};var buoyant=new $$Buoyant;
